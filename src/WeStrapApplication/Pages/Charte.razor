@page "/chart"

<WeRow RowColumnCount="WeRowCount.Row1" width="400" height="400">
    <Chart Labels="@Labels" DefaultChartType="line">
        <!--<WeSerie Label="# of Price" Values="@Prices" TDataset="Dataset" Type="bar">
        <WeRgba Red="255" Green="99" Blue="132" TDataset="Dataset"></WeRgba>
        <WeRgba Red="54" Green="162" Blue="235" TDataset="Dataset"></WeRgba>
        <WeRgba Red="255" Green="206" Blue="86" TDataset="Dataset"></WeRgba>
        <WeRgba Red="75" Green="192" Blue="192" TDataset="Dataset"></WeRgba>
        <WeRgba Red="153" Green="102" Blue="255" TDataset="Dataset"></WeRgba>
        <WeRgba Red="255" Green="159" Blue="64" TDataset="Dataset"></WeRgba>
    </WeSerie>-->
        <WeSerie Label="# of Votes" Values="@Votes" LineStyle="ls1" Type="bar" TDataset="Dataset"></WeSerie>
        <WeSerie Label="# of Prices" Values="@Prices" LineStyle="ls2" Fill="false" TDataset="WaterFallDataset"></WeSerie>
        <WeSerie Label="# of Todos +" Values="@Todos" LineStyle="ls3" Fill="false" TDataset="WaterFallDataset"></WeSerie>
    </Chart>
</WeRow>
@code {
    public List<double> Prices { get; set; } = new List<double>() {  };
    public List<double> Votes { get; set; } = new List<double>() { };
    public List<double> Todos { get; set; } = new List<double>() {  };
    public List<string> Labels { get; set; } = new List<string>
        () { "January", "February", "March", "April", "May", "June","July" };

    static RGBA? bg1 = new RGBA(10, 10, 255, 0.2);
    static RGBA? bg2 = new RGBA(10, 255, 10, 1);
    static RGBA? bg3 = new RGBA(255, 255, 10, 1);
    static BorderStyle? bs1 = new BorderStyle() { Width = 2 };
    static BorderStyle? bs2 = new BorderStyle() { Width = 3 };

    public LineStyle ls1 { get; set; } = new LineStyle() { Background = bg1, BorderStyle = bs1 };
    public LineStyle ls2 { get; set; } = new LineStyle() { Background = bg2, BorderStyle = bs2, Fill = "false" };
    public LineStyle ls3 { get; set; } = new LineStyle() { Background = bg3, BorderStyle = bs2, Fill = "false" };

    public RGBA hoverbg { get; set; } = new RGBA(10, 10, 255, 1);

    private int nbOfValues => Labels.Count();
    private bool auto_gen = true;
    protected override Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            GenerateValues(Prices, nbOfValues, 0, 30);
            GenerateValues(Votes, nbOfValues, 0, 30);
            GenerateValues(Todos, nbOfValues, 0, 30);
            InvokeAsync(() => StateHasChanged());
            if (auto_gen)
                Observable.Interval(TimeSpan.FromSeconds(3)).Subscribe(t =>
                {
                    GenerateValues(Prices, nbOfValues, 0, 30);
                    GenerateValues(Votes, nbOfValues, 0, 30);
                    GenerateValues(Todos, nbOfValues, 0, 30);
                    InvokeAsync(() => StateHasChanged());
                });

        }
        return base.OnAfterRenderAsync(firstRender);
    }

    private void GenerateValues(List<double> liste, int nbre, int from, int to)
    {
        Random rnd = new Random();
        liste.Clear();
        for (int i = 0; i < nbre; i++)
        {
            liste.Add((double)rnd.Next(from, to));
        }
    }
}
